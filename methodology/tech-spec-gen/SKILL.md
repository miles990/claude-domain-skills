---
name: tech-spec-gen
version: 2.0.0
description: 設計文件 → 技術規格生成器 — 將任何設計文件轉換為 AI 可執行的技術實作規格
triggers: [tech-spec, 技術規格, spec-gen, implementation-spec, 設計轉規格, design-to-spec]
keywords: [technical-specification, design-document, implementation, tasks, worktree, prd, gdd, frd]
author: claude-domain-skills
---

# Tech Spec Generator v2.0.0

> **通用設計文件 → 技術規格轉換器**
>
> 支援 GDD（遊戲設計文件）、PRD（產品需求文件）、FRD（功能需求文件）等任何設計文件格式
> 產出 AI Agent 可直接執行實作的技術文件

## 快速開始

```bash
# 完整轉換流程
/tech-spec-gen [設計文件路徑]           # 完整轉換

# 指定文件類型（可選，自動偵測）
/tech-spec-gen [路徑] --type gdd        # 遊戲設計文件
/tech-spec-gen [路徑] --type prd        # 產品需求文件
/tech-spec-gen [路徑] --type frd        # 功能需求文件
/tech-spec-gen [路徑] --type generic    # 通用設計文件

# 單一模組/功能轉換
/tech-spec-gen module [模組名稱]        # 單一模組的技術規格
/tech-spec-gen feature [Feature路徑]    # Feature Document → 技術規格

# 任務管理
/tech-spec-gen tasks                    # 顯示待實作任務
/tech-spec-gen worktree [task-id]       # 為特定任務建立 worktree
/tech-spec-gen status                   # 查看轉換狀態和進度
```

---

## 1. 核心理念

### 1.1 為什麼需要這個工具？

設計文件是給「人」看的，但 AI Agent 需要的是：

| 設計文件特徵 | AI 需要的規格 |
|-------------|--------------|
| 敘事性描述 | 明確的輸入/輸出定義 |
| 概念性說明 | 可驗證的完成標準 |
| 整體願景 | 獨立可執行的任務切分 |
| 靈活的解讀空間 | 技術決策的明確指引 |

### 1.2 支援的設計文件類型

| 類型 | 代碼 | 典型結構 | 適用場景 |
|------|------|----------|----------|
| **遊戲設計文件** | `gdd` | 設計支柱、核心玩法、機制、數值 | 遊戲開發 |
| **產品需求文件** | `prd` | 問題定義、用戶故事、功能列表 | 產品開發 |
| **功能需求文件** | `frd` | 功能規格、業務規則、流程圖 | 功能實作 |
| **系統設計文件** | `sdd` | 架構概述、模組設計、介面定義 | 系統開發 |
| **通用設計文件** | `generic` | 自動解析結構 | 任何文件 |

### 1.3 轉換原則

```
設計文件 → 技術規格 映射規則：
┌─────────────────────────────────────────────────────────────┐
│ 設計文件內容           →  技術規格對應                        │
├─────────────────────────────────────────────────────────────┤
│ 願景/目標              →  驗收標準 (Acceptance Criteria)      │
│ 功能描述               →  系統架構 + API 設計                 │
│ 業務規則/遊戲機制      →  資料模型 + 業務邏輯                 │
│ 數值/配置              →  常數定義 + 配置結構                 │
│ UI/UX 流程             →  狀態機 + 畫面規格                   │
│ 實體/角色/用戶         →  Entity Schema + 行為定義            │
│ 限制/約束              →  架構決策記錄 (ADR)                  │
└─────────────────────────────────────────────────────────────┘
```

### 1.4 產出原則

```
技術規格必須滿足：
├── ✅ AI 可直接讀取並執行
├── ✅ 每個任務可獨立實作
├── ✅ 有明確的驗收標準（Given-When-Then）
├── ✅ 不依賴隱含假設
├── ✅ 支援 worktree 隔離開發
└── ✅ 包含程式碼範例和測試案例
```

---

## 2. 技術規格標準結構

### 2.1 主規格文件 (tech-spec.md)

```markdown
# [專案名稱] 技術規格

> **版本**：v1.0 | **產生日期**：YYYY-MM-DD | **來源文件版本**：vX.X

## 目錄

1. [技術概覽](#1-技術概覽)
2. [系統架構](#2-系統架構)
3. [資料模型](#3-資料模型)
4. [API/介面定義](#4-api介面定義)
5. [狀態管理](#5-狀態管理)
6. [任務分解](#6-任務分解)
7. [驗收標準](#7-驗收標準)
8. [技術決策記錄](#8-技術決策記錄)

---

## 1. 技術概覽

### 1.1 技術棧確認

| 層級 | 技術選擇 | 版本 | 決策依據 |
|------|----------|------|----------|
| 語言 | | | |
| 框架 | | | |
| 資料庫 | | | |
| 測試框架 | | | |
| 部署環境 | | | |

### 1.2 專案結構

```
[專案根目錄]/
├── src/                    # 原始碼
│   ├── core/               # 核心邏輯
│   ├── domain/             # 領域層
│   ├── data/               # 資料層
│   ├── presentation/       # 呈現層
│   └── infrastructure/     # 基礎設施
├── tests/                  # 測試
├── docs/                   # 文件
└── config/                 # 配置
```

### 1.3 外部依賴

| 依賴 | 用途 | 版本約束 | 替代方案 |
|------|------|----------|----------|
| | | | |

---

## 2. 系統架構

### 2.1 高層架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                      [架構名稱]                               │
├─────────────────────────────────────────────────────────────┤
│  [各層/模組佈局]                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模組職責

| 模組 | 職責 | 依賴 | 對應設計文件章節 |
|------|------|------|------------------|
| | | | |

### 2.3 核心流程

[主要流程的序列圖或流程圖]

---

## 3. 資料模型

### 3.1 核心實體

```[語言]
// Entity 定義，包含欄位、類型、約束、驗證規則
```

### 3.2 資料關係

```
[ER 圖或關係說明]
```

### 3.3 常數與配置

```[語言]
// 從設計文件提取的數值常數
// 每個常數都標註來源章節
```

---

## 4. API/介面定義

### 4.1 公開 API

```[語言]
// 每個 API 的 signature、參數、回傳值、錯誤處理
// 包含使用範例
```

### 4.2 事件系統

| 事件名稱 | Payload | 觸發時機 | 訂閱者 |
|----------|---------|----------|--------|
| | | | |

---

## 5. 狀態管理

### 5.1 全局狀態

```[語言]
// 狀態結構、初始值、更新規則
```

### 5.2 狀態機定義

```
[狀態]─trigger─>[狀態]
```

---

## 6. 任務分解

### 6.1 任務總覽

| Task ID | 任務名稱 | 優先級 | 依賴 | 複雜度 | 狀態 |
|---------|----------|--------|------|--------|------|
| T001 | | P0/P1/P2 | | S/M/L/XL | pending |

### 6.2 Phase 分組

```
Phase 1: Foundation
├── T001: ...
└── T002: ...

Phase 2: Core
├── T003: ...
└── T004: ...

Phase 3: Integration
├── T005: ...
└── T006: ...
```

> 詳細任務規格請見 [tasks/](./tasks/) 目錄

---

## 7. 驗收標準

### 7.1 功能驗收

- [ ] [功能1]：[可測試的標準]
- [ ] [功能2]：[可測試的標準]

### 7.2 效能驗收

| 指標 | 目標 | 測試方法 |
|------|------|----------|
| | | |

### 7.3 品質驗收

- [ ] 測試覆蓋率 > X%
- [ ] 無 linter 警告
- [ ] 文件齊全

---

## 8. 技術決策記錄

### ADR-001: [決策標題]

**狀態**：已決定

**背景**：[為什麼需要這個決策]

**選項**：
1. [選項A] - 優缺點
2. [選項B] - 優缺點

**決定**：[選擇及原因]

**影響**：[帶來的影響]
```

### 2.2 任務規格模板 (task-spec.md)

```markdown
# Task [ID]: [任務名稱]

> **優先級**：P0/P1/P2 | **複雜度**：S/M/L/XL | **依賴**：[依賴任務]

## 目標

[一句話描述這個任務要達成什麼]

## 背景

### 相關設計文件章節
- [章節名稱及摘要]

### 相關技術規格
- [tech-spec.md 章節連結]

## 實作規格

### 需要建立的檔案

| 檔案路徑 | 用途 |
|----------|------|
| | |

### 程式碼規格

```[語言]
// 需要實作的介面/類別/函數
// 包含完整的 signature 和說明
```

## 驗收標準

### 功能驗收

- [ ] [具體可測試的標準1]
- [ ] [具體可測試的標準2]

### 測試案例

```
Given: [前置條件]
When: [執行動作]
Then: [預期結果]
```

### 邊界條件

| 情境 | 預期行為 |
|------|----------|
| | |

## 實作指引

### 建議實作順序

1. [步驟1]
2. [步驟2]

### 注意事項

- ⚠️ [重要提醒]

## Worktree 設定

```bash
git worktree add ../[project]-[task-id] -b feature/[task-id]-[name]
```
```

---

## 3. 文件類型偵測與映射

### 3.1 自動偵測規則

| 關鍵字/結構 | 判定為 | 信心度 |
|-------------|--------|--------|
| 設計支柱、核心玩法、遊戲機制 | GDD | 高 |
| 用戶故事、問題定義、市場分析 | PRD | 高 |
| 功能規格、業務規則、系統流程 | FRD | 高 |
| 架構概述、模組設計、API 定義 | SDD | 高 |
| 其他 | Generic | - |

### 3.2 類型專屬映射

#### GDD (遊戲設計文件)

| GDD 章節 | 技術規格對應 |
|----------|-------------|
| 設計支柱 | ADR (架構約束) |
| 核心玩法 | 系統架構 + 狀態機 |
| 遊戲機制 | API 設計 + 業務邏輯 |
| 數值設計 | 常數定義 |
| 角色設計 | Entity Schema |
| UI/UX | 畫面狀態機 |

#### PRD (產品需求文件)

| PRD 章節 | 技術規格對應 |
|----------|-------------|
| 問題定義 | 專案目標 (驗收標準) |
| 用戶故事 | 功能模組 + API |
| 功能列表 | 任務分解 |
| 成功指標 | 效能驗收標準 |
| 限制條件 | ADR |

#### FRD (功能需求文件)

| FRD 章節 | 技術規格對應 |
|----------|-------------|
| 功能描述 | API 設計 |
| 業務規則 | 業務邏輯 + 驗證規則 |
| 數據要求 | 資料模型 |
| 介面需求 | 外部整合 |
| 例外處理 | 錯誤處理策略 |

---

## 4. 轉換流程

### 4.1 五步驟轉換流程

```
/tech-spec-gen [設計文件路徑]

┌─────────────────────────────────────────────────────────────┐
│ Step 1: 文件解析與類型偵測                                    │
│ ├── 讀取主文件和關聯文件                                      │
│ ├── 自動偵測文件類型 (GDD/PRD/FRD/SDD/Generic)              │
│ ├── 提取結構化資訊                                           │
│ └── 識別技術棧需求                                           │
├─────────────────────────────────────────────────────────────┤
│ Step 2: 技術分析                                             │
│ ├── 分析技術棧（現有 or 建議）                               │
│ ├── 識別系統/功能模組                                        │
│ ├── 標記需要技術決策的點                                     │
│ └── 確認技術限制和約束                                       │
├─────────────────────────────────────────────────────────────┤
│ Step 3: 架構設計                                             │
│ ├── 設計高層架構                                             │
│ ├── 定義模組邊界和介面                                       │
│ ├── 設計資料模型                                             │
│ └── 定義核心 API                                             │
├─────────────────────────────────────────────────────────────┤
│ Step 4: 任務分解                                             │
│ ├── 依模組分解任務                                           │
│ ├── 建立依賴關係圖                                           │
│ ├── 估算複雜度 (S/M/L/XL)                                    │
│ └── 分配優先級 (P0/P1/P2)                                    │
├─────────────────────────────────────────────────────────────┤
│ Step 5: 規格產出                                             │
│ ├── 產生 tech-spec.md 主文件                                 │
│ ├── 產生 tasks/*.md 任務規格                                 │
│ ├── 產生 ADR 文件                                            │
│ └── 更新索引                                                 │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 互動式確認點

在以下節點會詢問使用者確認：

1. **Step 1 完成後**：確認偵測的文件類型
2. **Step 2 完成後**：確認技術棧選擇
3. **Step 3 完成後**：確認架構設計
4. **Step 5 完成前**：預覽任務分解

---

## 5. 任務分解策略

### 5.1 分解原則

```
任務分解黃金規則：
├── 單一職責：一個任務只做一件事
├── 可獨立測試：不需要其他任務完成也能測試
├── 明確邊界：輸入/輸出有清楚定義
├── 適當粒度：一個 session 可完成
└── 依賴清晰：依賴關係明確標示、無循環
```

### 5.2 標準任務類型

| 類型 | 代碼 | 說明 | 範例 |
|------|------|------|------|
| 基礎建設 | INFRA | 專案設定、環境配置 | 初始化專案結構 |
| 資料模型 | MODEL | 實體定義、Schema | 定義 User 模型 |
| 核心邏輯 | CORE | 業務邏輯、演算法 | 實作訂單計算 |
| API 層 | API | 介面定義、端點 | 實作 REST API |
| UI 元件 | UI | 畫面、互動 | 實作登入頁面 |
| 整合 | INTG | 模組整合、流程 | 整合支付流程 |
| 測試 | TEST | 單元/整合測試 | 測試認證模組 |

### 5.3 複雜度估算

| 複雜度 | 代碼 | 特徵 | 適合的任務 |
|--------|------|------|-----------|
| Small | S | 單一檔案、邏輯簡單 | 常數定義、簡單 API |
| Medium | M | 多檔案、需要設計 | 資料模型、UI 元件 |
| Large | L | 多模組互動、需測試 | 核心系統、整合 |
| Extra Large | XL | 核心架構、複雜邏輯 | 主系統、框架 |

### 5.4 Phase 劃分標準

```
Phase 1: Foundation (基礎)
├── 專案初始化
├── 核心資料模型
└── 基礎配置

Phase 2: Core (核心)
├── 核心業務邏輯
├── 主要 API
└── 資料存取層

Phase 3: Features (功能)
├── 功能模組 A
├── 功能模組 B
└── ...

Phase 4: Integration (整合)
├── 模組整合
├── 流程串接
└── 整合測試

Phase 5: Polish (收尾)
├── UI 優化
├── 效能調校
└── 文件完善
```

---

## 6. Worktree 整合

### 6.1 為什麼用 Worktree?

```
優點：
├── 每個任務獨立分支，避免衝突
├── 可以平行開發多個任務
├── 完成即 merge，失敗即刪除
├── AI Agent 可以獨立在 worktree 中工作
└── 保持主分支穩定
```

### 6.2 Worktree 工作流程

```bash
# 1. 查看可用任務
/tech-spec-gen tasks

# 輸出範例：
# Task ID | Name              | Priority | Status    | Dependencies
# T001    | 專案初始化         | P0       | pending   | -
# T002    | 核心資料模型       | P0       | pending   | T001
# T003    | 認證模組           | P1       | pending   | T002

# 2. 為任務建立 worktree
/tech-spec-gen worktree T002

# 執行動作：
# git worktree add ../[project]-T002 -b feature/T002-core-models
# cd ../[project]-T002
# 複製 TASK-SPEC.md 到 worktree

# 3. 在 worktree 中完成實作
# [AI Agent 根據 task spec 實作]

# 4. 完成後合併
# git checkout main
# git merge feature/T002-core-models
# git worktree remove ../[project]-T002
```

### 6.3 Worktree 中自動產生的檔案

```
../[project]-[task-id]/
├── TASK-SPEC.md          # 任務詳細規格
├── ACCEPTANCE.md         # 驗收標準清單
└── .claude/
    └── context.md        # AI Agent 上下文
```

---

## 7. 品質檢查

### 7.1 規格完整性檢查清單

```
技術規格品質檢查：
├── 架構
│   ├── □ 技術棧明確且有依據
│   ├── □ 模組職責清晰不重疊
│   └── □ 依賴關係明確無循環
├── 資料模型
│   ├── □ 所有實體有完整定義
│   ├── □ 欄位類型和約束明確
│   └── □ 關係和索引已定義
├── API 設計
│   ├── □ 所有公開 API 有簽名
│   ├── □ 參數和回傳值有說明
│   └── □ 錯誤處理已定義
├── 任務分解
│   ├── □ 每個任務有驗收標準
│   ├── □ 依賴關係無循環
│   ├── □ 複雜度估算合理
│   └── □ 優先級分配正確
└── 設計文件對應
    ├── □ 所有功能有對應任務
    ├── □ 所有數值有常數定義
    └── □ 約束條件有 ADR 記錄
```

### 7.2 常見問題與解決方案

| 問題 | 症狀 | 解決方案 |
|------|------|----------|
| 任務粒度太大 | 超過 15 個驗收標準 | 進一步分解為子任務 |
| 隱含假設 | 實作時發現缺少資訊 | 明確列出所有假設 |
| 循環依賴 | 任務無法開始 | 重新設計模組邊界 |
| 驗收標準模糊 | 「功能要好用」 | 改為 Given-When-Then |
| 技術棧不明 | 不知道用什麼框架 | 加入技術決策流程 |

---

## 8. 使用範例

### 8.1 遊戲專案 (GDD)

```bash
/tech-spec-gen docs/design/GDD-MASTER.md

# 輸出：
# ✅ 偵測文件類型：GDD (遊戲設計文件)
# ✅ 識別 Feature Documents: 5 個
# ✅ 分析技術棧：Flutter 3.38+ / Flame / Dart
# ✅ 識別系統模組：12 個
# ✅ 分解任務：27 個
# ✅ 產生技術規格於 docs/tech-spec/
```

### 8.2 Web 應用 (PRD)

```bash
/tech-spec-gen docs/PRD-v1.md

# 輸出：
# ✅ 偵測文件類型：PRD (產品需求文件)
# ✅ 識別用戶故事：15 個
# ✅ 建議技術棧：Next.js / TypeScript / PostgreSQL
# ✅ 識別功能模組：8 個
# ✅ 分解任務：32 個
# ✅ 產生技術規格於 docs/tech-spec/
```

### 8.3 API 服務 (FRD)

```bash
/tech-spec-gen docs/api-requirements.md --type frd

# 輸出：
# ✅ 文件類型：FRD (功能需求文件)
# ✅ 識別 API 端點：24 個
# ✅ 識別業務規則：18 條
# ✅ 建議技術棧：FastAPI / Python / MongoDB
# ✅ 分解任務：21 個
# ✅ 產生技術規格於 docs/tech-spec/
```

### 8.4 任務管理

```bash
# 查看任務清單
/tech-spec-gen tasks

# 查看特定任務
/tech-spec-gen tasks T006

# 開始任務（建立 worktree）
/tech-spec-gen worktree T006

# 標記任務狀態
/tech-spec-gen tasks T006 --status completed
```

---

## 9. 產出檔案結構

```
docs/
├── [設計文件]/              # 原有設計文件
│   └── xxx.md
└── tech-spec/               # 產生的技術規格
    ├── tech-spec.md         # 主規格文件
    ├── architecture.md      # 架構詳述 (可選)
    ├── data-models.md       # 資料模型詳述 (可選)
    ├── api-reference.md     # API 參考 (可選)
    ├── tasks/               # 任務規格
    │   ├── README.md        # 任務索引與依賴圖
    │   ├── T001-xxx.md
    │   ├── T002-xxx.md
    │   └── ...
    └── adr/                 # 架構決策記錄
        ├── ADR-001-xxx.md
        └── ...
```

---

## 10. 版本歷史

| 版本 | 日期 | 變更 |
|------|------|------|
| 2.0.0 | 2026-01-15 | 通用化：支援 GDD/PRD/FRD/SDD/Generic |
| 1.0.0 | 2026-01-15 | 初版：GDD 專用轉換器 |

---

## 相關資源

- **遊戲設計**：搭配 [game-planner](/game-planner) 產生 GDD
- **通用 Galgame**：搭配 [galgame-master](/galgame-master) 創作內容
- **任務管理**：使用 `/tech-spec-gen tasks` 管理進度
- **隔離開發**：使用 `/tech-spec-gen worktree` 建立開發環境
