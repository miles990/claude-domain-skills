---
schema: "1.0"
name: strategy-optimization
version: "1.0.0"
description: 交易策略優化方法論，從診斷到達標的迭代流程
triggers:
  keywords:
    primary: [策略優化, 優化策略, 提高勝率, 改善報酬, strategy optimization, improve returns]
    secondary: [win rate, 回測, backtest, 調參, parameter tuning, 績效改善]
  context_boost: [trading, quant, 交易, 量化, return, profit]
  context_penalty: [design, marketing, frontend]
  priority: high
keywords: [finance, trading, optimization, strategy, backtest]
dependencies:
  domain-skills: [quant-trading]
author: claude-domain-skills
---

# 交易策略優化 Strategy Optimization

> 系統化的策略優化流程，從診斷問題到達成目標

## 適用場景

- 勝率過低（< 40%）
- 報酬未達目標
- 策略在特定市場狀態表現差
- 需要達成特定報酬目標（如 15%+）

## 核心流程

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                   策略優化迭代循環                              │
│                                                                 │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐         │
│  │ ANALYZE │ → │ DIAGNOSE│ → │ RESEARCH│ → │IMPLEMENT│         │
│  │  分析   │   │  診斷   │   │  研究   │   │  實作   │         │
│  └────┬────┘   └────┬────┘   └────┬────┘   └────┬────┘         │
│       │             │             │             │               │
│       ▼             ▼             ▼             ▼               │
│  收集指標      找根因       搜尋方案      實作變更             │
│                                                                 │
│       ┌─────────────────────────────────────────┐               │
│       │                                         │               │
│       ▼                                         │               │
│  ┌─────────┐   ┌─────────┐                     │               │
│  │VALIDATE │ → │ ITERATE │ ────────────────────┘               │
│  │  驗證   │   │  迭代   │   未達標 → 回到 ANALYZE              │
│  └────┬────┘   └─────────┘                                      │
│       │                                                         │
│       ▼                                                         │
│   達標 → 文檔化部署                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Phase 1: ANALYZE（分析）

收集當前績效指標：

| 指標 | 說明 | 健康標準 |
|------|------|----------|
| **勝率** | 獲利交易比例 | > 40% |
| **報酬** | 總損益 | 正數 |
| **回撤** | 最大虧損幅度 | < 20% |
| **交易次數** | 統計顯著性 | > 100 筆 |
| **期望值** | 每筆預期獲利 | 正數 |

### 期望值公式

```
Expectancy = (WinRate × AvgWin) - ((1-WinRate) × AvgLoss)

範例：
勝率: 54.5%, 平均贏: $7.42, 平均輸: $8.26
期望值: (0.545 × 7.42) - (0.455 × 8.26) = +$0.29/筆

正期望值 × 大量交易 = 穩定獲利
```

## Phase 2: DIAGNOSE（診斷）

**關鍵：找根因，不是症狀**

### 常見根因

| 症狀 | 可能根因 | 診斷方法 |
|------|---------|---------|
| 勝率低 | 策略不適合市場狀態 | 檢查 ADX/市場 regime |
| 報酬低 | SL/TP 比例不佳 | 分析盈虧分布 |
| 回撤大 | 槓桿過高 | 計算風險暴露 |
| 交易少 | 條件太嚴格 | 放寬進場條件 |

### 市場狀態分析

```
┌─────────────────────────────────────────────────────────────────┐
│  市場狀態 vs 策略匹配                                           │
│                                                                 │
│  ADX < 25 (盤整)  → Grid Trading, Mean Reversion               │
│  ADX > 25 (趨勢)  → Trend Following, Momentum                   │
│  高波動            → Scalping, 減少部位                         │
│  低波動            → Grid Trading, Breakout 準備                │
│                                                                 │
│  ⚠️ 90% 時間市場在盤整，趨勢策略會持續虧損！                    │
└─────────────────────────────────────────────────────────────────┘
```

### 診斷範例

```
症狀: 勝率只有 25%
  ↓
分析: 使用 RSI+MACD 趨勢策略
  ↓
檢查: ADX 平均 < 25（90% 時間在盤整）
  ↓
根因: 趨勢策略用在盤整市場
  ↓
方向: 需要盤整市場策略（Grid Trading）
```

## Phase 3: RESEARCH（研究）

### 策略-市場狀態對應表

| 市場狀態 | 推薦策略 | 原因 |
|---------|---------|------|
| **盤整** (ADX < 25) | Grid Trading | 利用價格震盪 |
| | Mean Reversion | 回歸均值 |
| | Scalping | 快進快出 |
| **趨勢** (ADX > 25) | Trend Following | 順勢而為 |
| | Momentum | 動量延續 |
| | Breakout | 突破跟進 |
| **高波動** | Scalping | 快速獲利 |
| | 減少部位 | 控制風險 |

### Sharp Edge: 研究數據驗證

```
┌─────────────────────────────────────────────────────────────────┐
│  ⚠️ SE-1: 研究數據必須實測驗證                                  │
│                                                                 │
│  嚴重度: critical                                               │
│                                                                 │
│  案例：                                                         │
│  - 研究聲稱圖表模式有 80-84% 成功率                             │
│  - 實際回測：讓策略表現更差                                     │
│  - 原因：股市數據不適用於加密貨幣                               │
│                                                                 │
│  教訓：                                                         │
│  ❌ 看到研究數據就實作                                          │
│  ✅ 先用真實數據回測驗證                                        │
└─────────────────────────────────────────────────────────────────┘
```

## Phase 4: IMPLEMENT（實作）

### 參數調整策略

| 參數 | 調整方向 | 影響 |
|------|---------|------|
| **SL/TP 比例** | 對稱 (1:1) vs 非對稱 | 勝率 vs 盈虧比 |
| **槓桿** | 1x → 10x | 報酬 vs 風險 |
| **進場閾值** | 寬鬆 vs 嚴格 | 交易次數 vs 品質 |

### 關鍵發現

```
┌─────────────────────────────────────────────────────────────────┐
│  優化發現                                                       │
│                                                                 │
│  1. 對稱 SL/TP 更好                                             │
│     - 1.8%/1.8% 產生 ~55% 勝率                                  │
│     - 比 1%/3% 的表現更好                                       │
│                                                                 │
│  2. Grid Trading 在盤整市場                                     │
│     - 勝率從 25% 提升到 55%                                     │
│     - 關鍵：ADX < 25 時啟用                                     │
│                                                                 │
│  3. 更多交易 + 正期望值                                         │
│     - 小獲利累積成大報酬                                        │
│     - 191 筆交易 × $0.29/筆 = +$55                              │
└─────────────────────────────────────────────────────────────────┘
```

## Phase 5: VALIDATE（驗證）

### 回測要求

| 項目 | 最低要求 | 建議 |
|------|---------|------|
| 回測期間 | 60 天 | 180 天 |
| 交易次數 | 50 筆 | 100+ 筆 |
| 樣本外測試 | 有 | 必須 |
| 交易成本 | 包含 | 包含滑價 |

### 驗證清單

```markdown
□ 勝率是否改善？
□ 報酬是否達標？
□ 回撤是否可接受？
□ 期望值是否為正？
□ 樣本外表現如何？
```

## Phase 6: ITERATE（迭代）

```
未達標 → 回到 ANALYZE
  │
  ├── 分析新結果
  ├── 調整參數或策略
  ├── 重新驗證
  └── 重複直到達標
```

## 最佳實踐

1. **先診斷再動手** - 不要盲目調參數
2. **一次改一個變量** - 才能知道什麼有效
3. **驗證研究結論** - 理論數據不可信
4. **足夠的交易次數** - 統計顯著性
5. **文檔化成功經驗** - 寫成 ADR

## 常見錯誤

| 錯誤 | 後果 | 修正 |
|------|------|------|
| ❌ 只調參數不換策略 | 無法解決根本問題 | 先診斷根因 |
| ❌ 回測期間太短 | 過度擬合 | 180+ 天 |
| ❌ 忽略市場狀態 | 策略-市場不匹配 | 使用 Regime Detection |
| ❌ 追求高勝率 | 犧牲盈虧比 | 關注期望值 |

## 成功案例

```
優化前：
- 報酬: 0.46%
- 勝率: 23.5%
- 策略: RSI+MACD（趨勢策略用在盤整市場）

診斷：
- 90% 時間 ADX < 25（盤整）
- 趨勢策略不適合

優化後：
- 報酬: +19.93%
- 勝率: 54.5%
- 策略: Grid Trading + Regime Detection

關鍵改變：
1. 新增 Grid Trading 策略
2. 使用 Regime Detection 動態切換
3. 對稱 SL/TP (1.8%/1.8%)
4. 10x 槓桿 + 191 筆交易
```

## 風險警示

```
⚠️ 高報酬伴隨高風險

- 上述案例最大回撤 48.84%
- 考慮降低槓桿 (5x) 換取更低風險
- 持續監控市場狀態變化
- 設定停損機制
```

## 參考配置

```python
# 經過驗證的配置
config = {
    "leverage": 10.0,          # 或 5.0 降低風險
    "stop_loss_pct": 0.018,    # 1.8%
    "take_profit_pct": 0.018,  # 1.8%
    "top_n_signals": 3,
    "min_confidence": 0.5,
    "use_regime_selector": True,
}
```

## 相關 Skills

- `finance/quant-trading` - 量化交易基礎
- `finance/investment-analysis` - 投資分析
- `methodology/knowledge-acquisition-4c` - 學習新領域
